(function(a){var b="";if(require.s.contexts.hasOwnProperty("_")){b=require.s.contexts._.config.paths.JsMVA.replace("src/js/JsMVA.min","")}define(["d3"],function(c){return a({},c,b)})})(function(s,y,h){Object.size=function(z){return Object.keys(z).length};var u={margin:{x:20,y:20},node:{padding:10,yspace:40,xspace:20,width:150,height:40,mwidth:150,mheight:60,colors:{focus:"#033A00",closed:"#00A62B",pureBkg:"red",pureSig:"blue"},swidth:"4px"},link:{colors:{"default":"#CCC",focus:"#033A00"},width:"4px",focus_width:"8px"},aduration:1500,legend:{size:20,rect_width:100,rect_height:30,rect_fucus_width:115},text:{color:"#DEDEDE",padding:"4px"},buttons:{reset:{width:"36px",height:"36px",alpha:"0.5",img:h+"img/reset.png",background:"white"}}};var f=y.scale.linear().range([u.node.colors.pureBkg,u.node.colors.pureSig]);var d,n,m,k;var i=y.layout.tree();var j=(function(){var z=y.svg.diagonal();var A=function(D,B,C){if(C){return z(D)}return z({source:{x:(D.source.x+u.node.width),y:D.source.y},target:{x:(D.target.x+u.node.width),y:D.target.y-u.node.height}})};return A})();var q=function(z){if("children" in z){z._children=z.children;z.children=null}else{z.children=z._children;z._children=null}p(z)};var v=function(A){var z=u.node.height;A.append("text").attr("dy",z*0.35).attr("class","label1").attr("dx",u.text.padding).style("fill-opacity",0.000001).style("font-size",0.000001+"px").style("cursor","pointer").style("fill",u.text.color).style("font-weight","bold").text(function(B){return"S/(S+B)="+Number(B.info.purity).toFixed(3)});A.append("text").attr("class","label2").attr("dx",u.text.padding).attr("dy",z*0.75).style("fill-opacity",0.000001).style("cursor","pointer").text(function(B){return B.info.IVar!=-1?k[B.info.IVar]+">"+(Number(B.info.Cut).toFixed(3)):""}).style("font-size",0.000001+"px").style("fill",u.text.color).style("font-weight","bold")};var t=function(z,A){var B=z.enter().append("g").attr("class","nodes").attr("transform",function(D){return"translate("+A.x0+","+A.y0+")"}).style("cursor","pointer");B.filter(function(D){return D.parent}).on("click",q).on("mouseover",o).on("contextmenu",function(E,D){y.event.preventDefault();l(E)}).on("mouseleave",function(E,D){if(E.bigger){l(E,D,1)}return o(E,D,1)});B.append("rect").attr("width",0.000001).attr("height",0.000001);v(B);z.transition().duration(u.aduration).attr("transform",function(D){return"translate("+(D.x+u.node.width*0.5)+","+(D.y-u.node.height)+")"});z.select("rect").transition().duration(u.aduration).attr("width",u.node.width).attr("height",u.node.height).attr("fill",function(D){return f(Number(D.info.purity))}).style("stroke-width",u.node.swidth).style("stroke",function(D){return(D._children)?u.node.colors.closed:""});z.selectAll("text").transition().duration(u.aduration).style("font-size",function(F){var E="S/(S+B)="+Number(F.info.purity).toFixed(3);var D=F.info.IVar!=-1?k[F.info.IVar]+">"+(Number(F.info.Cut).toFixed(3)):"";F.font_size=1.5*(u.node.width-2*Number(u.node.swidth.replace("px","")))/Math.max(E.length,D.length);return F.font_size+"px"}).attr("dx",u.text.padding).attr("dy",function(D){return((y.select(this).attr("class")=="label1")?(u.node.height*0.35):(u.node.height*0.75))+"px"}).style("fill-opacity",1);var C=z.exit().transition().duration(u.aduration).attr("transform",function(D){return"translate("+(A.x+u.node.width)+","+A.y+")"}).remove();C.select("rect").attr("width",0.000001).attr("height",0.000001);C.selectAll("text").style("font-size",0.000001+"px").style("fill-opacity",0.000001)};var g=function(A,z){A.enter().insert("path","g").attr("class","link").attr("d",function(D,B){var C={x:z.x0,y:z.y0};return j({source:C,target:C},B,1)});A.transition().duration(u.aduration).attr("d",j).style("fill","none").style("stroke",u.link.colors["default"]).style("stroke-width",u.link.width).attr("id",function(B){return"link"+B.target.id});A.exit().transition().duration(u.aduration).attr("d",function(D,B){var C={x:z.x+u.node.width,y:z.y};return j({source:C,target:C},B,1)}).remove()};var o=function(B,A,z){n.selectAll("path.link").filter(function(C){return C.target.id==B.id}).style("stroke-width",(z)?u.link.width:u.link.focus_width).style("stroke",(z)?u.link.colors["default"]:u.link.colors.focus);n.selectAll("g.nodes rect").filter(function(C){return C.id==B.id}).style("stroke-width",u.node.swidth).style("stroke",function(C){return(z)?(C._children)?u.node.colors.closed:f(C.info.purity):u.node.colors.focus});if(B.parent){o(B.parent,A,z)}};var l=function(D,B,A){var C=(A)?u.node.width:2*u.node.width,z=(A)?u.node.height:1.5*u.node.height;console.log("anim height:"+String(z));n.selectAll("g.nodes rect").filter(function(E){E.bigger=(A)?false:true;return E.id==D.id}).transition().duration(u.aduration/2).attr("width",C+"px").attr("height",z+"px");n.selectAll("g.nodes text").filter(function(E){return E.id==D.id}).transition().duration(u.aduration/2).style("font-size",function(E){return((A)?E.font_size:2*E.font_size)+"px"}).attr("dx",(A)?u.text.padding:(2*Number(u.text.padding.replace("px",""))+"px")).attr("dy",function(){return((y.select(this).attr("class")=="label1")?(z*0.35):(z*0.75))+"px"});if(D.parent){l(D.parent,B,A)}};var p=function(C,F){e();var B=i.nodes(m),A=i.links(B);var E=0;B.forEach(function(G){if(E<Number(G.depth)){E=Number(G.depth)}});B.forEach(function(G){G.y=G.depth*d.height/E});if(!("x0") in C||!("y0" in C)){C.x0=B[0].x+u.node.width*0.5;C.y0=B[0].y-u.node.height}var z=n.selectAll("g.nodes").data(B,function(H,G){return H.id||(H.id=G)});t(z,C);var D=n.selectAll("path.link").data(A,function(G){return G.target.id});g(D,C);n.transition().duration(u.aduration).attr("transform","translate("+(-u.node.width)+", "+u.node.height+")");if(F!==undefined&&F==true){return}B.forEach(function(G){G.x0=G.x+u.node.width;G.y0=G.y})};var r=function(z){if(z.length!==undefined){var B=0;for(var A in z){B+=r(z[A])}return B}if(!("children" in z)||z.children.length==0){return 0}return 1+r(z.children)};var x=function(z){var A=Array();for(var B in z){if(A.indexOf(Math.round(z[B].x))==-1){A.push(Math.round(z[B].x))}}return A.length+1};var c=function(B){var D=1000000,z=-1000000;var A;for(var C in B){A=Number(B[C].info.purity);if(A<D){D=A}if(A>z){z=A}}return[D,z]};var e=function(D){var B=i.nodes(m);var A;for(var C in B){if(!B[C].parent){A=B[C];break}}var z=r(A);u.node.height=d.height/(z+1)-u.node.yspace;if(u.node.height>u.node.mheight){u.node.height=u.node.mheight}var E=0;while(z!=0){if(!(z%4)){E++}z/=4}u.node.width=d.width/(x(B)+1-E)-u.node.xspace;if(u.node.width>u.node.mwidth){u.node.height=u.node.mwidth}i.size([d.width,d.height]);f.domain(c(B))};var a=function(A){var C=[{text:"Pure Backg.",id:"label1",color:f(f.domain()[0]),x:5,y:5},{text:"Pure Signal",id:"label2",color:f(f.domain()[1]),x:5,y:40}];var z=A.append("g").attr("transform","translate(5,5)");var B=z.selectAll("g").data(C,function(D){return D.id}).enter().append("g").style("cursor","pointer").attr("transform",function(D){return"translate("+D.x+","+D.y+")"});B.on("mouseover",function(D){y.select("#"+D.id).style("font-weight","bold");y.select("#"+D.id+"_rect").attr("width",u.legend.rect_fucus_width)});B.on("mouseout",function(D){y.select("#"+D.id).style("font-weight","normal");y.select("#"+D.id+"_rect").attr("width",u.legend.rect_width)});B.append("rect").attr("id",function(D){return D.id+"_rect"}).attr("width",u.legend.rect_width).attr("height",u.legend.rect_height).attr("fill",function(D){return D.color});B.append("text").attr("id",function(D){return D.id}).attr("x",function(D){return 5}).attr("y",function(D){return 20}).text(function(D){return D.text}).style("fill",u.text.color)};var w=function(A){if("_children" in A&&A.children==null){A.children=A._children;A._children=null}if("children" in A&&A.children!=null){for(var z in A.children){w(A.children[z])}}};var b=function(D){var C=[];var B=[];B.push(D);while(B.length>0){var A=B.shift();if("_children" in A&&A._children!=null){C.push(A)}if(A.children!=null){for(var z=0;z<A.children.length;z++){B.push(A.children[z])}}}return C.length>0?C:D};s.draw=function(D,B){var C=y.select("#"+D);m=B.tree;k=B.variables;if(Object.size(m)==0){C.innerHTML="<b style='color:red'>Tree empty...</b>";return}d={width:C.property("style")["width"],height:C.property("style")["height"]};n=C.append("svg").attr("width",d.width).attr("height",d.height);var A=n;Object.keys(d).forEach(function(E){d[E]=Number(d[E].replace("px",""));d[E]-=E=="width"?2*u.margin.x+u.node.width:2*u.margin.y+u.node.height});e(1);var z=y.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){n.attr("transform","translate("+(-u.node.width)+", "+u.node.height+")translate("+y.event.translate+")scale("+y.event.scale+")")});n=n.on("dblclick",function(){z.scale(1);z.translate([0,0]);n.transition().attr("transform","translate("+(-u.node.width)+", "+u.node.height+")")}).append("g").call(z).append("g").attr("transform","translate("+(-u.node.width)+", "+u.node.height+")");a(A);p(m);C.append("button").style("position","relative").style("top","-"+u.buttons.reset.height).style("width",u.buttons.reset.width).style("height",u.buttons.reset.height).style("opacity",u.buttons.reset.alpha).style("background",u.buttons.reset.background).style("background-size","contain").style("background-image","url("+u.buttons.reset.img+")").style("cursor","pointer").style("border","none").on("mouseover",function(){y.select(this).style("opacity","1")}).on("mouseout",function(){y.select(this).style("opacity",u.buttons.reset.alpha)}).on("click",function(){z.scale(1);z.translate([0,0]);n.transition().attr("transform","translate("+(-u.node.width)+", "+u.node.height+")");var F=b(m);for(var E=0;E<F.length;E++){w(F[E]);p(F[E],true)}})};Object.seal(s);return s});